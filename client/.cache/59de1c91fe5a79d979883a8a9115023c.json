{"dependencies":[{"name":"/Volumes/Users/kayak/.cix/builds/src/controlr/plugin/client/.babelrc","includedInParent":true,"mtime":1518774302000},{"name":"/Volumes/Users/kayak/.cix/builds/src/controlr/plugin/client/tsconfig.json","includedInParent":true,"mtime":1518774302000},{"name":"vue","loc":{"line":37,"column":16}},{"name":"vuex","loc":{"line":38,"column":17}},{"name":"../constants","loc":{"line":39,"column":27}},{"name":"./api","loc":{"line":40,"column":16}},{"name":"./socket","loc":{"line":41,"column":19}},{"name":"./app","loc":{"line":42,"column":16}}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0});var e=require(\"vue\"),t=p(e),r=require(\"vuex\"),n=p(r),o=require(\"../constants\"),s=d(o),i=require(\"./api\"),u=p(i),a=require(\"./socket\"),c=p(a),f=require(\"./app\"),l=p(f);function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function p(e){return e&&e.__esModule?e:{default:e}}var E=function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,u)}a((n=n.apply(e,t||[])).next())})},m=function(e,t){var r,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(r=1,n&&(o=n[2&s[0]?\"return\":s[0]?\"throw\":\"next\"])&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[0,o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},h=void 0;t.default.use(n.default);var v,S,w=function(e){for(var t={},r=0,n=e.split(\",\");r<n.length;r++){var o=n[r].split(\"|\");if(2===o.length){var s=o[0].toLowerCase(),i=o[1];if(3===i.length)if(/([r-][w-][x-])/.test(i))if(\"-\"!==i.charAt(0)){var u=i.charAt(1),a=i.charAt(2);if(\"w\"!==u||\"x\"!==a){var c={read:!0,write:\"w\"===u,execute:\"x\"===a};t[s]={visible:!0,allowed:c}}else t[s]={visible:!0,allowed:{read:!0,write:!0,execute:!0}}}else t[s]={visible:!1};else t[s]={visible:!1}}}return t},y=function(e){var t=\"\";return e.forEach(function(e){e.visible&&(\"\"===t?t=e.name.toLowerCase()+\"|\"+(e.read?\"r\":\"-\")+(e.write?\"w\":\"-\")+(e.execute?\"x\":\"-\"):t+=\",\"+e.name.toLowerCase()+\"|\"+(e.read?\"r\":\"-\")+(e.write?\"w\":\"-\")+(e.execute?\"x\":\"-\"))}),t},R=function(e){return new Promise(function(t){return setTimeout(t,e)})},_={version:\"\",token:\"\",username:\"\",isAuthorized:!1,isBusy:!1,hasError:!1,errCode:0,errMsg:\"\",socket:null,users:[],apps:[],selectedUser:\"\"},b=((v={})[s.GET_VERSION]=function(e){return u.default.getVersion().then(function(t){return e.commit(s.GOT_VERSION,t)})},v[s.LOGIN]=function(e,t){var r=t.username,n=t.password,o=t.router;e.commit(s.IS_BUSY,!0),u.default.login({username:r,password:n}).then(function(t){return e.commit(s.LOGIN_SUCCESS,{data:t,username:r,router:o})}).catch(function(t){return e.commit(s.LOGIN_FAILURE,t)})},v[s.INIT]=function(e){var t=(\"https:\"===document.location.protocol?\"wss\":\"ws\")+\"://\"+document.location.host+\"/skt/?token=\"+_.token,r=new c.default(t,function(){return e.dispatch(s.REFRESH)});r.receive(function(t){var r=JSON.parse(t.data);\"string\"==typeof r.topic&&r.topic.length>0&&e.dispatch(r.topic,r.payload)}),e.commit(s.SET_SOCKET,r)},v[s.REFRESH]=function(e){e.commit(s.IS_BUSY,!0),e.state.socket.send({topic:s.REFRESH,payload:{}})},v[s.REFRESHED]=function(e,t){e.commit(s.UPDATE_ALL,t)},v[s.SET_PERM]=function(e,t){var r=t.id,n=t.perm,o=e.state.users.find(function(t){return t.name===e.state.selectedUser});if(o){e.state.apps.find(function(e){return e.id===r}).setPerm(n);var i=y(e.state.apps);e.commit(s.IS_BUSY,!0),e.state.socket.send({topic:s.UPDATE_PERMS,payload:{idx:o.idx,name:o.name,perms:i}})}},v[s.PERMS_UPDATED]=function(e){return E(h,void 0,void 0,function(){return m(this,function(t){switch(t.label){case 0:return[4,R(1e3)];case 1:return t.sent(),e.state.socket.send({topic:s.REFRESH,payload:{}}),[2]}})})},v[s.ACCESS_ERROR]=function(e,t){e.commit(s.SET_ERROR,t)},v),C=((S={})[s.IS_BUSY]=function(e,t){return e.isBusy=t},S[s.GOT_VERSION]=function(e,t){return e.version=t.version},S[s.LOGIN_SUCCESS]=function(e,t){var r=t.data,n=t.username,o=t.router;e.token=r.token,e.isAuthorized=!0,e.isBusy=!1,e.username=n,e.hasError=!1,e.errCode=0,e.errMsg=\"\",o.push(s.PERMS)},S[s.LOGIN_FAILURE]=function(e,t){e.token=\"\",e.isAuthorized=!1,e.isBusy=!1,e.username=\"\",e.hasError=!0,e.errCode=t.code,e.errMsg=t.msg},S[s.REMOVE_FEEDBACK]=function(e){e.hasError=!1,e.errCode=0,e.errMsg=\"\"},S[s.LOGOUT]=function(e){e.isBusy=!1,e.isAuthorized=!1,e.username=\"\",e.token=\"\",e.errCode=0,e.errMsg=\"\"},S[s.SET_SOCKET]=function(e,t){e.socket=t},S[s.UPDATE_ALL]=function(e,t){if(e.users=t.users,e.apps=t.apps.map(function(e){return new l.default(e.name,e.type,e.logo,e.id)}),t.users.length>0){var r=\"\";r=\"\"!==e.selectedUser?e.selectedUser:t.users[0].name;var n=e.users.find(function(e){return e.name===r}),o=w(n.desc);e.apps.forEach(function(e){e.applyPerms(o[e.name.toLowerCase()])}),e.selectedUser=r}e.isBusy=!1},S[s.SELECT_USER]=function(e,t){var r=e.users.find(function(e){return e.name===t}),n=w(r.desc);e.apps.forEach(function(e){e.applyPerms(n[e.name.toLowerCase()])}),e.selectedUser=t},S[s.SET_ERROR]=function(e,t){e.isBusy=!1,e.hasError=!0,e.errCode=t.errCode,e.errMsg=t.errMsg},S),O=new n.default.Store({state:_,mutations:C,actions:b});exports.default=O;"},"hash":"7404adfdf52ad24b378d159757cc5896","cacheData":{"env":{}}}